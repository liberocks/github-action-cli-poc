# GitHub Action CLI Authenticator (PoC)

This Proof of Concept demonstrates how to create a Python CLI to securely authenticate team members and trigger a GitHub Action workflow using **GitHub OAuth Device Authorization Flow**.

By using the **GitHub App Device Flow**, you **do not need to distribute static Personal Access Tokens (PATs) or static credentials** to your team. Instead, the CLI directs them to an authentication URL in their browser, generating a short-lived access token on the fly. 

Because we use a **GitHub App installed only on this repository**, the resulting authentication token is strictly scoped. Even if the user belongs to many organizations, the CLI token will **only** have access to the repository where the App is installed.

## Prerequisites

- Python 3.7+
- The `requests` Python package

```bash
pip install requests
```

## How to Set up the GitHub App (For Scoped Access)

To ensure the CLI only has access to this specific repository and not all the organizations a user belongs to, we use a **GitHub App** rather than an OAuth App. **This must be set up in the Web UI.**

1. Go to your GitHub Settings -> Developer settings -> **[GitHub Apps](https://github.com/settings/apps)**.
2. Click **New GitHub App**.
3. Fill in the details:
   - **GitHub App name**: e.g., "My Team CLI Automator"
   - **Homepage URL**: e.g., `https://github.com/YOUR_ORG`
   - **Webhook**: Uncheck "Active" (we don't need webhooks).
4. Under **Repository permissions**, find **Actions** and change it to **Read and write**.
   *(No other permissions are required!)*
5. Click **Create GitHub App**.
6. On the left sidebar, click **Install App**.
7. Install the App **Only on the specific repository** (e.g. `github-action-cli-poc`). This is what restricts the access!
8. Go back to the App's **General** settings page.
9. Scroll down to **Device flow** and click **Enable Device Flow**.
10. Copy the **Client ID** generated for your application.

## Configuration

Open `cli.py` in your favorite editor and set the variables at the top:

```python
# Replace this with the Client ID of your GitHub OAuth App
CLIENT_ID = "YOUR_OAUTH_APP_CLIENT_ID"

# Update with your repository details if you cloned this elsewhere
REPO_OWNER = "liberocks"
REPO_NAME = "github-action-cli-poc"
```

## Running the CLI

Run the CLI using Python:

```bash
python cli.py
```

### What happens?
1. The script will request an OAuth Device Code.
2. It will prompt you to visit a URL in your browser and enter an 8-character code.
3. You will log into your GitHub account and authorize the App (only requires permission to access exactly what you currently have access to).
4. The CLI script automatically resumes.
5. It triggers the `.github/workflows/trigger.yml` action using your authenticated identity.
6. It polls GitHub for the status of the workflow run.
7. Upon completion, it downloads the zip artifact generated by the workflow, extracts `output.json`, and parses it into the terminal.
