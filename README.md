# GitHub Action CLI Authenticator (PoC)

This Proof of Concept demonstrates how to create a Python CLI to securely authenticate team members and trigger a GitHub Action workflow using **GitHub OAuth Device Authorization Flow**.

By using OAuth Device Flow, you **do not need to distribute static Personal Access Tokens (PATs) or static credentials** to your team. Instead, the CLI directs them to an authentication URL in their browser, generating a short-lived access token on the fly. This ensures that only users who genuinely have access to the repository on GitHub can trigger the workflows.

## Prerequisites

- Python 3.7+
- The `requests` Python package

```bash
pip install requests
```

## How to Set up the GitHub OAuth App

Because you are using the Device Flow, you must register an OAuth App in your GitHub Developer Settings. **This cannot be done via API and must be done in the Web UI.**

1. Go to your GitHub Settings -> Developer settings -> **[OAuth Apps](https://github.com/settings/developers)**.
2. Click **New OAuth App**.
3. Fill in the details:
   - **Application name**: e.g., "My Team CLI Automator"
   - **Homepage URL**: e.g., `https://github.com/YOUR_ORG`
   - **Authorization callback URL**: Since this is a CLI using the device flow, a callback URL isn't strictly used, but you must enter one. A generic placeholder like `http://localhost:8080` is fine.
4. **Important**: After creating the app, click **Enable Device Flow** on the app's configuration page under the "Device flow" section.
5. Copy the **Client ID** generated for your application.

## Configuration

Open `cli.py` in your favorite editor and set the variables at the top:

```python
# Replace this with the Client ID of your GitHub OAuth App
CLIENT_ID = "YOUR_OAUTH_APP_CLIENT_ID"

# Update with your repository details if you cloned this elsewhere
REPO_OWNER = "liberocks"
REPO_NAME = "github-action-cli-poc"
```

## Running the CLI

Run the CLI using Python:

```bash
python cli.py
```

### What happens?
1. The script will request an OAuth Device Code.
2. It will prompt you to visit a URL in your browser and enter an 8-character code.
3. You will log into your GitHub account and authorize the App (only requires permission to access exactly what you currently have access to).
4. The CLI script automatically resumes.
5. It triggers the `.github/workflows/trigger.yml` action using your authenticated identity.
6. It polls GitHub for the status of the workflow run.
7. Upon completion, it downloads the zip artifact generated by the workflow, extracts `output.json`, and parses it into the terminal.
